<script type="module">
  // ...seu código anterior...

  let userAnswers = []; // Array para guardar as respostas do usuário

  // No startQuiz, resetar o array
  function startQuiz() {
    currentQuestionIndex = 0;
    score = 0;
    userAnswers = [];
    nextButton.innerHTML = "Próximo";
    startTimer();
    showQuestion();
  }

  function selectAnswer(e) {
    const selectedBtn = e.target;
    const isCorrect = selectedBtn.dataset.correct === "true";

    // Salvar a resposta do usuário para a questão atual
    userAnswers[currentQuestionIndex] = {
      question: questions[currentQuestionIndex].question,
      selectedAnswer: selectedBtn.innerHTML,
      correctAnswer: questions[currentQuestionIndex].answers.find(a => a.correct).text,
      isCorrect: isCorrect
    };

    if (isCorrect) {
      selectedBtn.classList.add("correct");
      score++;
    } else {
      selectedBtn.classList.add("incorrect");
    }
    Array.from(answerButtons.children).forEach(button => {
      if (button.dataset.correct === "true") {
        button.classList.add("correct");
      }
      button.disabled = true;
    });
    nextButton.style.display = "block";
  }

  async function showScore() {
    clearInterval(timerInterval);
    resetState();

    // Criar um container para mostrar resultado detalhado
    const resultContainer = document.createElement("div");
    resultContainer.style.padding = "20px";
    resultContainer.style.color = "#001e4d";

    // Resumo acertos e erros
    const totalErrors = totalQuestions - score;

    const summary = document.createElement("h2");
    summary.textContent = `Você acertou ${score} e errou ${totalErrors} de ${totalQuestions} questões.`;
    resultContainer.appendChild(summary);

    // Lista detalhada das respostas
    const list = document.createElement("ol");
    list.style.marginTop = "20px";

    userAnswers.forEach((answer, index) => {
      const item = document.createElement("li");
      item.style.marginBottom = "10px";

      // Texto com a pergunta
      const questionText = document.createElement("p");
      questionText.textContent = `${index + 1}. ${answer.question}`;

      // Texto com a resposta do usuário
      const userAnswerText = document.createElement("p");
      userAnswerText.textContent = `Sua resposta: ${answer.selectedAnswer}`;

      // Texto com a resposta correta
      const correctAnswerText = document.createElement("p");
      correctAnswerText.textContent = `Resposta correta: ${answer.correctAnswer}`;

      // Cor do texto conforme acerto ou erro
      if (answer.isCorrect) {
        userAnswerText.style.color = "green";
      } else {
        userAnswerText.style.color = "red";
      }

      item.appendChild(questionText);
      item.appendChild(userAnswerText);
      if (!answer.isCorrect) {
        item.appendChild(correctAnswerText);
      }

      list.appendChild(item);
    });

    resultContainer.appendChild(list);

    // Botão para recomeçar o quiz
    const restartButton = document.createElement("button");
    restartButton.textContent = "Recomeçar Quiz";
    restartButton.style.marginTop = "20px";
    restartButton.style.padding = "10px 20px";
    restartButton.style.fontSize = "1rem";
    restartButton.style.cursor = "pointer";
    restartButton.style.borderRadius = "5px";
    restartButton.style.backgroundColor = "#001e4d";
    restartButton.style.color = "#fff";
    restartButton.addEventListener("click", () => {
      totalTime = 2 * 60 * 60 + 30 * 60; // resetar tempo
      timerElement.style.display = "block";
      progressBar.style.display = "block";
      document.querySelector(".quiz").style.display = "block";
      resultContainer.remove();
      startQuiz();
    });

    // Esconder timer, barra de progresso e quiz para mostrar resultado
    timerElement.style.display = "none";
    progressBar.style.display = "none";
    document.querySelector(".quiz").style.display = "none";

    document.querySelector(".app").appendChild(resultContainer);
    document.querySelector(".app").appendChild(restartButton);

    if (currentUser) {
      const resultado = {
        score: score,
        totalQuestions: totalQuestions,
        tempoRestante: timerElement.textContent,
        timestamp: serverTimestamp()
      };
      try {
        await setDoc(doc(db, "quizResults", currentUser.uid), resultado);
      } catch (error) {
        alert("Erro ao salvar resultado: " + error.message);
      }
    }
  }

  // Ajuste na função handleNextButton para evitar updateProgressBar dupla
  function handleNextButton() {
    currentQuestionIndex++;
    if (currentQuestionIndex < questions.length) {
      showQuestion();
    } else {
      showScore();
    }
  }

  // Restante do seu código permanece igual...
</script>
