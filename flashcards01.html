<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flashcards SDEL</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    .card { border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; background: #f9f9f9; }
    #quiz-area { margin-top: 2rem; }
    button { margin: 5px; padding: 8px 12px; }
  </style>
</head>
<body>
  <h1>Bem-vindo ao SDEL Flashcards</h1>

  <button id="logout">Sair</button>

  <h2>Criar novo flashcard</h2>
  <input type="text" id="subject" placeholder="Matéria"><br>
  <input type="text" id="question" placeholder="Pergunta"><br>
  <input type="text" id="answer" placeholder="Resposta"><br>
  <button id="create">Criar Flashcard</button>

  <h2>Seus Flashcards</h2>
  <div id="flashcards"></div>

  <button id="start-quiz">Iniciar Quiz</button>

  <div id="quiz-area" style="display:none;">
    <h2>Quiz</h2>
    <p id="quiz-question"></p>
    <button id="show-answer">Mostrar Resposta</button>
    <p id="quiz-answer" style="display:none;"></p>
    <button id="next-question">Próxima Pergunta</button>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      query,
      where
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCj8i37JYNigvbhXfqP4HVzjAEOzcXf_i0",
      authDomain: "sdel-b3f65.firebaseapp.com",
      projectId: "sdel-b3f65",
      storageBucket: "sdel-b3f65.firebasestorage.app",
      messagingSenderId: "297725999985",
      appId: "1:297725999985:web:d41da68311c190ef8a54d0",
      measurementId: "G-PT92VECJ2H"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null;
    let userFlashcards = [];
    let currentQuizIndex = 0;

    const subjectInput = document.getElementById("subject");
    const questionInput = document.getElementById("question");
    const answerInput = document.getElementById("answer");
    const flashcardsDiv = document.getElementById("flashcards");
    const quizArea = document.getElementById("quiz-area");
    const quizQuestion = document.getElementById("quiz-question");
    const quizAnswer = document.getElementById("quiz-answer");

    // Verifica se o usuário está logado
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        await carregarFlashcards();
      } else {
        window.location.href = "login.html";
      }
    });

    // Criar flashcard
    document.getElementById("create").addEventListener("click", async () => {
      const subject = subjectInput.value.trim();
      const question = questionInput.value.trim();
      const answer = answerInput.value.trim();

      if (subject && question && answer) {
        const docRef = await addDoc(collection(db, "flashcards"), {
          uid: currentUser.uid,
          subject,
          question,
          answer
        });
        subjectInput.value = "";
        questionInput.value = "";
        answerInput.value = "";
        await carregarFlashcards();
      }
    });

    // Carregar flashcards
    async function carregarFlashcards() {
      flashcardsDiv.innerHTML = "";
      userFlashcards = [];

      const q = query(collection(db, "flashcards"), where("uid", "==", currentUser.uid));
      const querySnapshot = await getDocs(q);
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        userFlashcards.push(data);
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<strong>${data.subject}</strong><br>Pergunta: ${data.question}<br>Resposta: ${data.answer}`;
        flashcardsDiv.appendChild(div);
      });
    }

    // Iniciar quiz
    document.getElementById("start-quiz").addEventListener("click", () => {
      if (userFlashcards.length === 0) {
        alert("Você não tem flashcards.");
        return;
      }
      currentQuizIndex = 0;
      quizArea.style.display = "block";
      flashcardsDiv.style.display = "none";
      mostrarPergunta();
    });

    function mostrarPergunta() {
      const card = userFlashcards[currentQuizIndex];
      quizQuestion.textContent = card.question;
      quizAnswer.textContent = card.answer;
      quizAnswer.style.display = "none";
    }

    document.getElementById("show-answer").addEventListener("click", () => {
      quizAnswer.style.display = "block";
    });

    document.getElementById("next-question").addEventListener("click", () => {
      currentQuizIndex++;
      if (currentQuizIndex < userFlashcards.length) {
        mostrarPergunta();
      } else {
        alert("Quiz finalizado!");
        quizArea.style.display = "none";
        flashcardsDiv.style.display = "block";
      }
    });

    // Sair
    document.getElementById("logout").addEventListener("click", () => {
      signOut(auth).then(() => {
        window.location.href = "login.html";
      });
    });
  </script>
</body>
</html>
